<!DOCTYPE html>
<html>
  <head>
    <%- include ('../../includes/head') %>
    <title>Sign Up - Snappy Book Review</title>
  </head>
  <body>
    <%- include('../../includes/header') %>
    <div class="sbr-maincontainer">
      <h1>Create an account</h1>
      <p>Want to log in? Click <a href="<%= config.siteUrl %>/account/log-in/">here</a> to log in.</p>
      <p>An account will let you leave reviews on books and much more.</p>
      <form class="sbr-form" id="signupform">
        <div class="sbr-form-field">
          <label for="first_name_input" class="sbr-form-label">First Name</label>
          <input class="sbr-form-control" id="first_name_input">
        </div>
        <div class="sbr-form-field">
          <label for="last_name_input" class="sbr-form-label">Last Name</label>
          <input class="sbr-form-control" id="last_name_input">
        </div>
        <div class="sbr-form-field">
          <label for="email_input" class="sbr-form-label">Email adress</label>
          <input type="email" class="sbr-form-control" id="email_input">
        </div>
        <div class="sbr-form-field">
          <label for="password_input" class="sbr-form-label">Password</label>
          <input type="password" class="sbr-form-control" id="password_input" aria-describedby="password_help">
          <div id="password_help" class="sbr-form-text">
            Your password must be 8-20 characters long, containing at least one letter and one number.
          </div>
        </div>
        <button type="submit" class="sbr-form-submit-btn">Log in</button>
        <div id="form_submit_info"></div>
      </form>
    </div>
    <%- include('../../includes/footer') %>
    <script>
      function formSubmit(infobox) {
        const nameregex = /^[a-zA-Z ]{1,255}$/;
        // Check first name, last name validity
        const firstName = document.getElementById('first_name_input').value;
        if (!firstName.match(nameregex)) {
          if (firstName.length > 0) {
            Common.CommonUI.errorMessage(infobox, 'First name invalid.');
          } else {
            Common.CommonUI.errorMessage(infobox, 'First name required.');
          }
          return;
        }
        const lastName = document.getElementById('last_name_input').value;
        if (!lastName.match(nameregex)) {
          if (lastName.length > 0) {
            Common.CommonUI.errorMessage(infobox, 'Last name invalid.');
          } else {
            Common.CommonUI.errorMessage(infobox, 'Last name required.');
          }
          return;
        }
        const emailRegex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        const email = document.getElementById('email_input').value;
        if (!email.match(emailRegex) || email.length > 254) {
          if (email.length > 0) {
            Common.CommonUI.errorMessage(infobox, 'Email adress invalid.');
          } else {
            Common.CommonUI.errorMessage(infobox, 'Email adress required.');
          }
          return;
        }
        const passwordRegex = /(?=.*\d)(?=.*[a-zA-Z]).{8,20}/;
        const password = document.getElementById('password_input').value;
        if (password.length === 0) {
          Common.CommonUI.errorMessage(infobox, 'Password required.')
          return;
        }
        if (!password.match(passwordRegex)) {
          Common.CommonUI.errorMessage(infobox, 'Password invalid. (Please check password constraints.)');
          return;
        }
        /*const verifypassword = document.getElementById('verify_password_input').value;
        if (password !=== verifypassword) {
          Common.CommonUI.errorMessage(infobox, 'Passwords do not match.');
          return;
        }*/

        Common.CommonUI.loadingIcon(infobox);

        const xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            successMessage(infobox, this.responseText);
          }
          else if (this.readyState == 4) {
            Common.CommonUI.errorMessage(infobox, this.responseText);
          }
        };
        xhttp.open('POST', '<%= config.siteUrl %>/account/create-account/submit/', true);
        xhttp.setRequestHeader('Content-Type', 'application/json');
        const data = {
          firstName: firstName,
          lastName: lastName,
          email: email,
          password: password
        }
        xhttp.send(JSON.stringify(data));
      }
    </script>
    <script>
      document.getElementById('signupform').addEventListener('submit',
        function () {
          event.preventDefault();
          formSubmit(document.getElementById('form_submit_info'));
        });
    </script>
  </body>
</html>